<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Crunchyroll</title>
</head>
<body>
<div id="CrunchyrollPluginConfigPage" data-role="page" class="page type-interior pluginConfigurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
    <div data-role="content">
        <div class="content-primary">
            <form id="CrunchyrollPluginConfigForm">
                <div class="inputContainer">
                    <label class="inputLabel inputLabelUnfocused" for="CrunchyrollUrl">CrunchyrollUrl</label>
                    <input id="CrunchyrollUrl" name="CrunchyrollUrl" type="text" is="emby-input" />
                    <div class="fieldDescription">CrunchyrollUrl</div>
                </div>
                <div class="inputContainer">
                    <label class="inputLabel inputLabelUnfocused" for="CrunchyrollLanguage">CrunchyrollLanguage</label>
                    <input id="CrunchyrollLanguage" name="CrunchyrollLanguage" type="text" is="emby-input" />
                    <div class="fieldDescription">Crunchyroll Language in ISO 639-1. Example: en-US</div>
                </div>
                <div class="inputContainer">
                    <label class="inputLabel inputLabelUnfocused" for="ArchiveOrgUrl">ArchiveOrgUrl</label>
                    <input id="ArchiveOrgUrl" name="ArchiveOrgUrl" type="text" is="emby-input" />
                    <div class="fieldDescription">ArchiveOrgUrl</div>
                </div>
                <div class="inputContainer">
                    <label class="inputLabel inputLabelUnfocused" for="LocalDatabasePath">LocalDatabasePath</label>
                    <input id="LocalDatabasePath" name="LocalDatabasePath" type="text" is="emby-input" />
                    <div class="fieldDescription">default: empty; if you want a different path instead of the plugin folder, enter here the absolute path</div>
                </div>
                <div class="inputContainer">
                    <label class="emby-checkbox-label">
                        <input id="IsWaybackMachineEnabled" name="IsWaybackMachineEnabled" type="checkbox" is="emby-checkbox" />
                        <span>IsWaybackMachineEnabled</span>
                    </label>
                    <div class="fieldDescription">
                        Uncheck if you want to use the Crunchyroll Api.
                        It was developed before the reviews & comments were disabled, but currently it only returns an empty response.
                        If someday the reviews & comments are enabled again, you can use this feature instead.
                    </div>
                </div>
                <div class="inputContainer">
                    <label class="inputLabel inputLabelUnfocused" for="WaybackMachineWaitTimeoutInSeconds">WaybackMachineWaitTimeoutInSeconds</label>
                    <input id="WaybackMachineWaitTimeoutInSeconds" name="WaybackMachineWaitTimeoutInSeconds" type="number" is="emby-input" min="0" />
                    <div class="fieldDescription">Timeout in seconds; This timeout only occurs when the request to wayback machine are throttled
                        or refused due to the ddos protection</div>
                </div>
                <div class="inputContainer">
                    <label class="inputLabel inputLabelUnfocused" for="LibraryPath">LibraryPath</label>
                    <input id="LibraryPath" name="LibraryPath" type="text" is="emby-input" />
                    <div class="fieldDescription">It is recommended to specify which folders to scan for. 
                        Good if you have an Anime-Library and specify only the path to the library here.
                        Keep it empty to scan in all folders</div>
                </div>
                <div class="inputContainer">
                    <label class="emby-checkbox-label">
                        <input id="IsOrderSeasonsByCrunchyrollOrderEnabled" name="IsOrderSeasonsByCrunchyrollOrderEnabled" type="checkbox" is="emby-checkbox" />
                        <span>OrderSeasonsByCrunchyrollOrder</span>
                    </label>
                    <div class="fieldDescription">
                        Feature to order your seasons in the the crunchyroll order. For exmaple, Seasons with 
                        OADs or movies will be ordered in between season 1 and 2. 
                        The order depends on your metadata language and the available Crunchyroll seasons in that language. 
                        Default: enabled
                    </div>
                </div>
                <div>
                    <button is="emby-button" type="submit" class="raised button-submit block emby-button">
                        <span>Save</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    <script type="text/javascript">
        var CrunchyrollPluginConfig = {
            pluginUniqueId: 'c6f8461a-9a6f-4c65-8bb9-825866cabc91'
        };

        document.querySelector('#CrunchyrollPluginConfigPage')
            .addEventListener('pageshow', function() {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(CrunchyrollPluginConfig.pluginUniqueId).then(function (config) {
                    document.querySelector('#CrunchyrollUrl').value = config.CrunchyrollUrl;
                    document.querySelector('#CrunchyrollLanguage').value = config.CrunchyrollLanguage;
                    document.querySelector('#ArchiveOrgUrl').value = config.ArchiveOrgUrl;
                    document.querySelector('#LocalDatabasePath').value = config.LocalDatabasePath;
                    document.querySelector('#IsWaybackMachineEnabled').checked = config.IsWaybackMachineEnabled;
                    document.querySelector('#LibraryPath').value = config.LibraryPath;
                    document.querySelector('#WaybackMachineWaitTimeoutInSeconds').value = config.WaybackMachineWaitTimeoutInSeconds;
                    document.querySelector('#IsOrderSeasonsByCrunchyrollOrderEnabled').checked = config.IsOrderSeasonsByCrunchyrollOrderEnabled;
                    Dashboard.hideLoadingMsg();
                });
            });

        document.querySelector('#CrunchyrollPluginConfigPage')
            .addEventListener('submit', function(e) {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(CrunchyrollPluginConfig.pluginUniqueId).then(function (config) {
                    config.CrunchyrollUrl = document.querySelector('#CrunchyrollUrl').value;
                    config.CrunchyrollLanguage = document.querySelector('#CrunchyrollLanguage').value;
                    config.ArchiveOrgUrl = document.querySelector('#ArchiveOrgUrl').value;
                    config.LocalDatabasePath = document.querySelector('#LocalDatabasePath').value;
                    config.LibraryPath = document.querySelector('#LibraryPath').value;
                    config.WaybackMachineWaitTimeoutInSeconds = document.querySelector('#WaybackMachineWaitTimeoutInSeconds').value;
                    config.IsWaybackMachineEnabled = document.querySelector('#IsWaybackMachineEnabled').checked;
                    config.IsOrderSeasonsByCrunchyrollOrderEnabled = document.querySelector('#IsOrderSeasonsByCrunchyrollOrderEnabled').checked;
                    ApiClient.updatePluginConfiguration(CrunchyrollPluginConfig.pluginUniqueId, config).then(function (result) {
                        Dashboard.processPluginConfigurationUpdateResult(result);
                    });
                });

                e.preventDefault();
                return false;
            });
    </script>
</div>
</body>
</html>